{% extends 'staff/base_staff.html' %}

{% block title %}Dashboard - Quản trị{% endblock %}

{% block staff_content %}
<h2 class="mb-4"><i class="bi bi-speedometer2"></i> Dashboard</h2>

<!-- Statistics Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="mb-0">{{ total_books }}</h4>
                        <small>Tổng số sách</small>
                    </div>
                    <i class="bi bi-book display-4 opacity-50"></i>
                </div>
            </div>
            <div class="card-footer bg-transparent border-0">
                <a href="{% url 'staff_book_list' %}" class="text-white text-decoration-none">
                    Xem chi tiết <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="mb-0">{{ total_orders }}</h4>
                        <small>Tổng đơn hàng</small>
                    </div>
                    <i class="bi bi-bag display-4 opacity-50"></i>
                </div>
            </div>
            <div class="card-footer bg-transparent border-0">
                <a href="{% url 'staff_order_list' %}" class="text-white text-decoration-none">
                    Xem chi tiết <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-warning text-dark">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="mb-0">{{ pending_orders }}</h4>
                        <small>Đơn chờ xử lý</small>
                    </div>
                    <i class="bi bi-hourglass-split display-4 opacity-50"></i>
                </div>
            </div>
            <div class="card-footer bg-transparent border-0">
                <a href="{% url 'staff_order_list' %}?status=pending" class="text-dark text-decoration-none">
                    Xem chi tiết <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="mb-0">{{ low_stock_books }}</h4>
                        <small>Sách sắp hết</small>
                    </div>
                    <i class="bi bi-exclamation-triangle display-4 opacity-50"></i>
                </div>
            </div>
            <div class="card-footer bg-transparent border-0">
                <a href="{% url 'staff_book_list' %}" class="text-white text-decoration-none">
                    Xem chi tiết <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Recent Orders -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-clock-history"></i> Đơn hàng gần đây</h5>
                <a href="{% url 'staff_order_list' %}" class="btn btn-sm btn-outline-primary">Xem tất cả</a>
            </div>
            <div class="card-body">
                {% if recent_orders %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Mã đơn</th>
                                <th>Khách hàng</th>
                                <th>Tổng tiền</th>
                                <th>Trạng thái</th>
                                <th>Ngày đặt</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in recent_orders %}
                            <tr>
                                <td>
                                    <a href="{% url 'staff_order_detail' order.id %}">#{{ order.id }}</a>
                                </td>
                                <td>{{ order.customer.name }}</td>
                                <td>{{ order.total_price|floatformat:0 }}đ</td>
                                <td>
                                    {% if order.status == 'pending' %}
                                    <span class="badge bg-warning">Chờ xử lý</span>
                                    {% elif order.status == 'confirmed' %}
                                    <span class="badge bg-info">Đã xác nhận</span>
                                    {% elif order.status == 'shipping' %}
                                    <span class="badge bg-primary">Đang giao</span>
                                    {% elif order.status == 'delivered' %}
                                    <span class="badge bg-success">Đã giao</span>
                                    {% else %}
                                    <span class="badge bg-danger">Đã hủy</span>
                                    {% endif %}
                                </td>
                                <td>{{ order.created_at|date:"d/m/Y H:i" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted text-center mb-0">Chưa có đơn hàng nào.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Low Stock Alert -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Sách sắp hết</h5>
            </div>
            <div class="card-body">
                {% if low_stock %}
                <ul class="list-group list-group-flush">
                    {% for book in low_stock %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ book.title|truncatechars:30 }}</strong>
                        </div>
                        <span class="badge bg-danger rounded-pill">{{ book.stock_quantity }}</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted text-center mb-0">Không có sách nào sắp hết.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
